<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小孔成像虚拟实验平台</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background-color: #0a0a2a;
            color: #64ffda;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .experiment-area {
            flex: 3;
            position: relative;
            overflow: hidden;
            perspective: 2000px;
            background: linear-gradient(135deg, #0a0a2a 0%, #1a1a4a 100%);
        }
        
        .control-panel {
            flex: 1;
            background-color: #112240;
            padding: 20px;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            z-index: 20;
        }
        
        .scene-container {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            overflow: hidden;
        }
        
        .scene {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }
        
        .world {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            perspective: 2000px;
        }
        
        /* 光学轴 - 无形但定义了三个面板中心点的连线 */
        .optical-axis {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 1500px;
            height: 1px;
            background-color: transparent;
            transform-style: preserve-3d;
            transform: translate(-50%, -50%) rotateY(90deg);
        }
        
        /* 物体面板 (左侧) */
        .object-panel {
            position: absolute;
            width: 300px;
            height: 400px;
            background: rgba(139, 69, 19, 0.7);
            top: 0;
            left: -350px;
            transform-style: preserve-3d;
            border: 1px solid #8b4513;
            box-shadow: 0 0 15px rgba(139, 69, 19, 0.5);
            transition: left 0.5s ease;
            transform: translateY(-50%) rotateY(-90deg);
        }
        
        /* 小孔面板 (中间) */
        .pinhole-panel {
            position: absolute;
            width: 400px;
            height: 500px;
            background: rgba(139, 69, 19, 0.9);
            top: 0;
            left: 0;
            transform-style: preserve-3d;
            border: 1px solid #8b4513;
            box-shadow: 0 0 15px rgba(139, 69, 19, 0.5);
            transform: translateY(-50%) rotateY(-90deg);
        }
        
        /* 像面板 (右侧) */
        .image-panel {
            position: absolute;
            width: 300px;
            height: 400px;
            background: rgba(0, 0, 0, 0.9);
            top: 0;
            left: 350px;
            transform-style: preserve-3d;
            border: 1px solid #333;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            transition: left 0.5s ease;
            transform: translateY(-50%) rotateY(-90deg);
        }
        
        /* 小孔 */
        .pinhole {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            z-index: 6;
        }
        
        /* 光源 - 蜡烛 */
        .candle {
            position: absolute;
            width: 40px;
            height: 120px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transform-style: preserve-3d;
            z-index: 5;
        }
        
        .candle-body {
            position: absolute;
            width: 40px;
            height: 120px;
            background: linear-gradient(to bottom, #f5f5dc, #ffd700);
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .candle-flame {
            position: absolute;
            width: 25px;
            height: 50px;
            background: radial-gradient(ellipse at center, #ffff00 0%, #ff8c00 60%, #ff4500 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            top: -40px;
            left: 7.5px;
            filter: blur(2px);
            animation: flicker 0.5s infinite alternate;
            box-shadow: 0 0 20px rgba(255, 165, 0, 0.8), 0 0 30px rgba(255, 69, 0, 0.6);
        }
        
        @keyframes flicker {
            0% {
                transform: scaleY(1.1) scaleX(0.9);
                opacity: 0.9;
            }
            100% {
                transform: scaleY(0.9) scaleX(1.1);
                opacity: 1;
            }
        }
        
        /* 像 - 倒置且左右相反的蜡烛火焰 */
        .image-flame {
            position: absolute;
            width: 25px;
            height: 50px;
            background: radial-gradient(ellipse at center, rgba(255, 255, 0, 0.6) 0%, rgba(255, 140, 0, 0.6) 60%, rgba(255, 69, 0, 0.6) 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(180deg) scaleX(-1);
            filter: blur(3px);
            box-shadow: 0 0 20px rgba(255, 165, 0, 0.5), 0 0 30px rgba(255, 69, 0, 0.3);
        }
        
        /* F形光源 */
        .f-shape {
            position: absolute;
            width: 70px;
            height: 140px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transform-style: preserve-3d;
            z-index: 5;
            display: none; /* 默认隐藏，可通过控制切换显示 */
        }
        
        .f-vertical {
            position: absolute;
            top: 0;
            left: 0;
            width: 20px;
            height: 140px;
            background: linear-gradient(to bottom, #ffff00, #ff8c00);
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.8);
        }
        
        .f-top {
            position: absolute;
            top: 0;
            left: 0;
            width: 70px;
            height: 20px;
            background: linear-gradient(to right, #ffff00, #ff8c00);
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.8);
        }
        
        .f-middle {
            position: absolute;
            top: 55px;
            left: 0;
            width: 50px;
            height: 20px;
            background: linear-gradient(to right, #ffff00, #ff8c00);
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.8);
        }
        
        /* F形像 - 倒置且左右相反 */
        .f-image-shape {
            position: absolute;
            width: 70px;
            height: 140px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(180deg) scaleX(-1);
            transform-style: preserve-3d;
            z-index: 5;
            display: none; /* 默认隐藏，可通过控制切换显示 */
        }
        
        .f-image-vertical {
            position: absolute;
            top: 0;
            left: 0;
            width: 20px;
            height: 140px;
            background: rgba(255, 140, 0, 0.6);
            box-shadow: 0 0 10px rgba(255, 140, 0, 0.5);
            filter: blur(2px);
        }
        
        .f-image-top {
            position: absolute;
            top: 0;
            left: 0;
            width: 70px;
            height: 20px;
            background: rgba(255, 140, 0, 0.6);
            box-shadow: 0 0 10px rgba(255, 140, 0, 0.5);
            filter: blur(2px);
        }
        
        .f-image-middle {
            position: absolute;
            top: 55px;
            left: 0;
            width: 50px;
            height: 20px;
            background: rgba(255, 140, 0, 0.6);
            box-shadow: 0 0 10px rgba(255, 140, 0, 0.5);
            filter: blur(2px);
        }
        
        .control-section {
            margin-bottom: 25px;
            background-color: #1d3b5f;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #64ffda;
            box-shadow: 0 0 10px rgba(100, 255, 218, 0.2);
        }
        
        .control-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #64ffda;
            text-shadow: 0 0 5px rgba(100, 255, 218, 0.5);
            border-bottom: 1px solid #64ffda;
            padding-bottom: 5px;
        }
        
        .slider-container {
            margin-bottom: 10px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 10px;
            background: linear-gradient(to right, #0a192f, #64ffda);
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #64ffda;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px #64ffda;
        }
        
        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        button {
            padding: 8px 15px;
            background-color: #1d3b5f;
            color: #64ffda;
            border: 1px solid #64ffda;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 5px rgba(100, 255, 218, 0.3);
        }
        
        button:hover {
            background-color: rgba(100, 255, 218, 0.2);
            box-shadow: 0 0 10px rgba(100, 255, 218, 0.5);
        }
        
        .shape-options {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .shape-option {
            width: 30px;
            height: 30px;
            border: 1px solid #64ffda;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .shape-option:hover {
            background-color: rgba(100, 255, 218, 0.2);
        }
        
        .shape-option.active {
            background-color: rgba(100, 255, 218, 0.3);
            box-shadow: 0 0 10px #64ffda;
        }
        
        .phenomenon-indicator {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(29, 59, 95, 0.8);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid #64ffda;
            color: #64ffda;
            font-size: 14px;
            z-index: 10;
            box-shadow: 0 0 10px rgba(100, 255, 218, 0.3);
            max-width: 300px;
        }
        
        .header {
            text-align: center;
            padding: 15px 0;
            font-size: 24px;
            text-shadow: 0 0 10px rgba(100, 255, 218, 0.5);
            background-color: #112240;
            border-bottom: 2px solid #64ffda;
            position: relative;
            z-index: 15;
        }
        
        .mouse-control-hint {
            position: absolute;
            top: 70px;
            left: 20px;
            background-color: rgba(29, 59, 95, 0.8);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid #64ffda;
            color: #64ffda;
            font-size: 14px;
            z-index: 10;
            box-shadow: 0 0 10px rgba(100, 255, 218, 0.3);
        }
        
        .source-selector {
            margin-top: 15px;
        }
        
        .source-selector label {
            margin-right: 15px;
            cursor: pointer;
        }
        
        .source-selector input {
            margin-right: 5px;
        }
        
        /* 面向前方的面 - 这是像面板的显示面 */
        .panel-front {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            transform-style: preserve-3d;
            transform: translateZ(1px); /* 让前面稍微凸出 */
        }
        
        /* 面向后方的面 - 这是光源面板的显示面 */
        .panel-back {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            transform-style: preserve-3d;
            transform: translateZ(-1px) rotateY(180deg); /* 背面旋转180度 */
        }
    </style>
</head>
<body>
    <div class="header">小孔成像虚拟实验平台</div>
    <div class="container">
        <div class="experiment-area">
            <div class="scene-container" id="sceneContainer">
                <div class="scene" id="scene">
                    <div class="world" id="world">
                        <!-- 光学轴 -->
                        <div class="optical-axis" id="opticalAxis">
                            <!-- 物体面板 (左侧) -->
                            <div class="object-panel" id="objectPanel">
                                <div class="panel-back">
                                    <!-- 默认是蜡烛 -->
                                    <div class="candle" id="candle">
                                        <div class="candle-body"></div>
                                        <div class="candle-flame"></div>
                                    </div>
                                    
                                    <!-- 可选的F光源 -->
                                    <div class="f-shape" id="fShape">
                                        <div class="f-vertical"></div>
                                        <div class="f-top"></div>
                                        <div class="f-middle"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 小孔面板 (中间) -->
                            <div class="pinhole-panel" id="pinholePanel">
                                <div class="panel-front">
                                    <div class="pinhole" id="pinhole"></div>
                                </div>
                            </div>
                            
                            <!-- 像面板 (右侧) -->
                            <div class="image-panel" id="imagePanel">
                                <div class="panel-front">
                                    <!-- 蜡烛的像 -->
                                    <div class="image-flame" id="imageFlame"></div>
                                    
                                    <!-- F形像 -->
                                    <div class="f-image-shape" id="fImageShape">
                                        <div class="f-image-vertical"></div>
                                        <div class="f-image-top"></div>
                                        <div class="f-image-middle"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mouse-control-hint">
                左键拖拽：旋转视角<br>
                右键拖拽：平移视角<br>
                滚轮：缩放视角
            </div>
            
            <div class="phenomenon-indicator" id="phenomenonIndicator">
                现象提示：小孔成像成上下颠倒，左右相反的实像。
            </div>
        </div>
        <div class="control-panel">
            <div class="control-section">
                <div class="control-title">物距控制</div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>近</span>
                        <span id="objectDistanceValue">35cm</span>
                        <span>远</span>
                    </div>
                    <input type="range" id="objectDistance" min="10" max="100" value="35">
                </div>
            </div>
            
            <div class="control-section">
                <div class="control-title">像距控制</div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>近</span>
                        <span id="imageDistanceValue">35cm</span>
                        <span>远</span>
                    </div>
                    <input type="range" id="imageDistance" min="10" max="100" value="35">
                </div>
            </div>
            
            <div class="control-section">
                <div class="control-title">小孔设置</div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>小</span>
                        <span id="pinholeSize">5px</span>
                        <span>大</span>
                    </div>
                    <input type="range" id="pinholeSizeSlider" min="2" max="15" value="5">
                </div>
                <div class="control-title" style="font-size: 16px; margin-top: 15px;">小孔形状</div>
                <div class="shape-options">
                    <div class="shape-option active" data-shape="circle">●</div>
                    <div class="shape-option" data-shape="square">■</div>
                    <div class="shape-option" data-shape="triangle">▲</div>
                    <div class="shape-option" data-shape="star">★</div>
                </div>
            </div>
            
            <div class="control-section">
                <div class="control-title">光源设置</div>
                <div class="source-selector">
                    <label><input type="radio" name="lightSource" value="candle" checked> 蜡烛光源</label>
                    <label><input type="radio" name="lightSource" value="fShape"> F形光源</label>
                </div>
                <div class="button-container" style="margin-top: 15px;">
                    <button id="rotateCW">顺时针旋转</button>
                    <button id="rotateCCW">逆时针旋转</button>
                </div>
                <div class="slider-container" style="margin-top: 15px;">
                    <div class="slider-label">
                        <span>小</span>
                        <span id="lightSizeValue">100%</span>
                        <span>大</span>
                    </div>
                    <input type="range" id="lightSize" min="50" max="150" value="100">
                </div>
            </div>
            
            <div class="control-section">
                <div class="control-title">视角控制</div>
                <div class="button-container">
                    <button id="resetView">重置视角</button>
                    <button id="frontView">正视图</button>
                    <button id="topView">俯视图</button>
                    <button id="sideView">侧视图</button>
                </div>
                <div class="button-container" style="margin-top: 10px;">
                    <button id="moveLeft">左移</button>
                    <button id="moveRight">右移</button>
                    <button id="moveUp">上移</button>
                    <button id="moveDown">下移</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const sceneContainer = document.getElementById('sceneContainer');
        const scene = document.getElementById('scene');
        const world = document.getElementById('world');
        const opticalAxis = document.getElementById('opticalAxis');
        const pinhole = document.getElementById('pinhole');
        const candle = document.getElementById('candle');
        const fShape = document.getElementById('fShape');
        const imageFlame = document.getElementById('imageFlame');
        const fImageShape = document.getElementById('fImageShape');
        const objectPanel = document.getElementById('objectPanel');
        const pinholePanel = document.getElementById('pinholePanel');
        const imagePanel = document.getElementById('imagePanel');
        const phenomenonIndicator = document.getElementById('phenomenonIndicator');
        
        // 获取控制元素
        const objectDistanceSlider = document.getElementById('objectDistance');
        const objectDistanceValue = document.getElementById('objectDistanceValue');
        const imageDistanceSlider = document.getElementById('imageDistance');
        const imageDistanceValue = document.getElementById('imageDistanceValue');
        const pinholeSizeSlider = document.getElementById('pinholeSizeSlider');
        const pinholeSizeValue = document.getElementById('pinholeSize');
        const lightSizeSlider = document.getElementById('lightSize');
        const lightSizeValue = document.getElementById('lightSizeValue');
        const lightSourceRadios = document.querySelectorAll('input[name="lightSource"]');
        
        // 视角控制按钮
        const resetViewBtn = document.getElementById('resetView');
        const frontViewBtn = document.getElementById('frontView');
        const topViewBtn = document.getElementById('topView');
        const sideViewBtn = document.getElementById('sideView');
        const moveLeftBtn = document.getElementById('moveLeft');
        const moveRightBtn = document.getElementById('moveRight');
        const moveUpBtn = document.getElementById('moveUp');
        const moveDownBtn = document.getElementById('moveDown');
        
        // 光源旋转按钮
        const rotateCW = document.getElementById('rotateCW');
        const rotateCCW = document.getElementById('rotateCCW');
        
        // 小孔形状选项
        const shapeOptions = document.querySelectorAll('.shape-option');
        
        // 视角状态
        let cameraRotationX = 0;
        let cameraRotationY = 0;
        let cameraTranslateX = 0;
        let cameraTranslateY = 0;
        let cameraTranslateZ = 0;
        let cameraZoom = 1;
        
        // 初始光源旋转角度
        let lightRotation = 0;
        let imageRotation = 180;
        
        // 鼠标控制状态
        let isLeftMouseDown = false;
        let isRightMouseDown = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        
        // 当前光源类型
        let currentLightSource = 'candle'; // 默认是蜡烛
        
        // 初始化函数
        function initialize() {
            // 设置初始视角
            cameraRotationX = 10;
            cameraRotationY = -20;
            updateCameraView();
            
            // 设置初始状态
            setLightSource('candle');
            updateScene();
        }
        
        // 更新摄像机视角
        function updateCameraView() {
            scene.style.transform = `
                translateX(${cameraTranslateX}px)
                translateY(${cameraTranslateY}px)
                translateZ(${cameraTranslateZ}px)
                scale(${cameraZoom})
                rotateX(${cameraRotationX}deg)
                rotateY(${cameraRotationY}deg)
            `;
        }
        
        // 更新场景函数
        function updateScene() {
            // 计算物距和像距
            const objectDistancePercent = parseInt(objectDistanceSlider.value);
            const imageDistancePercent = parseInt(imageDistanceSlider.value);
            
            // 物体面板位置 (左侧) - 更大范围的物距
            const objectZ = -350 - (objectDistancePercent - 35) * 10;
            
            // 像面板位置 (右侧) - 更大范围的像距
            const imageZ = 350 + (imageDistancePercent - 35) * 10;
            
            // 更新物体和像面板位置
            objectPanel.style.left = `${objectZ}px`;
            imagePanel.style.left = `${imageZ}px`;
            
            // 更新显示值
            objectDistanceValue.textContent = `${objectDistancePercent}cm`;
            imageDistanceValue.textContent = `${imageDistancePercent}cm`;
            
            // 计算像大小比例 (物理准确的比例关系)
            // 像大小与物体大小成比例: (像距/物距)
            const objectDistance = Math.abs(objectZ);
            const imageDistance = Math.abs(imageZ);
            const sizeRatio = imageDistance / objectDistance;
            
            // 应用像大小比例
            const lightSizePercent = parseInt(lightSizeSlider.value);
            const baseSizePercent = lightSizePercent / 100; // 基础大小百分比
            
            // 根据当前光源类型更新相应元素大小
            if (currentLightSource === 'candle') {
                // 蜡烛光源 - 倒立且左右相反的像
                const imageScale = baseSizePercent * sizeRatio;
                imageFlame.style.transform = `translate(-50%, -50%) rotate(${imageRotation}deg) scaleX(-1) scale(${imageScale})`;
                candle.style.transform = `translate(-50%, -50%) rotate(${lightRotation}deg) scale(${baseSizePercent})`;
            } else {
                // F形光源 - 倒立且左右相反的像
                const imageScale = baseSizePercent * sizeRatio;
                fImageShape.style.transform = `translate(-50%, -50%) rotate(${imageRotation}deg) scaleX(-1) scale(${imageScale})`;
                fShape.style.transform = `translate(-50%, -50%) rotate(${lightRotation}deg) scale(${baseSizePercent})`;
            }
            
            lightSizeValue.textContent = `${lightSizePercent}%`;
            
            // 更新小孔大小
            const pinholeSize = parseInt(pinholeSizeSlider.value);
            pinhole.style.width = `${pinholeSize}px`;
            pinhole.style.height = `${pinholeSize}px`;
            pinholeSizeValue.textContent = `${pinholeSize}px`;
            
            // 小孔越大，图像越模糊（通过模糊效果和亮度模拟）
            const blurAmount = (pinholeSize - 2) * 0.7; // 2px对应无模糊
            const brightnessPercent = 50 + pinholeSize * 3; // 亮度随小孔增大而增加
            
            imageFlame.style.filter = `blur(${blurAmount}px) brightness(${brightnessPercent}%)`;
            fImageShape.style.filter = `blur(${blurAmount}px) brightness(${brightnessPercent}%)`;
        }
        
        // 设置光源类型
        function setLightSource(type) {
            currentLightSource = type;
            
            if (type === 'candle') {
                candle.style.display = 'block';
                imageFlame.style.display = 'block';
                fShape.style.display = 'none';
                fImageShape.style.display = 'none';
            } else {
                candle.style.display = 'none';
                imageFlame.style.display = 'none';
                fShape.style.display = 'block';
                fImageShape.style.display = 'block';
            }
            
            updateScene();
        }
        
        // 初始化
        initialize();
        
        // 事件监听器 - 滑块控制
        objectDistanceSlider.addEventListener('input', updateScene);
        imageDistanceSlider.addEventListener('input', updateScene);
        pinholeSizeSlider.addEventListener('input', updateScene);
        lightSizeSlider.addEventListener('input', updateScene);
        
        // 光源类型选择
        lightSourceRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                setLightSource(this.value);
            });
        });
        
        // 视角控制按钮
        resetViewBtn.addEventListener('click', () => {
            cameraRotationX = 10;
            cameraRotationY = -20;
            cameraTranslateX = 0;
            cameraTranslateY = 0;
            cameraTranslateZ = 0;
            cameraZoom = 1;
            updateCameraView();
        });
        
        frontViewBtn.addEventListener('click', () => {
            cameraRotationX = 0;
            cameraRotationY = 0;
            updateCameraView();
        });
        
        topViewBtn.addEventListener('click', () => {
            cameraRotationX = 90;
            cameraRotationY = 0;
            updateCameraView();
        });
        
        sideViewBtn.addEventListener('click', () => {
            cameraRotationX = 0;
            cameraRotationY = -90;
            updateCameraView();
        });
        
        // 平移控制
        moveLeftBtn.addEventListener('click', () => {
            cameraTranslateX += 50;
            updateCameraView();
        });
        
        moveRightBtn.addEventListener('click', () => {
            cameraTranslateX -= 50;
            updateCameraView();
        });
        
        moveUpBtn.addEventListener('click', () => {
            cameraTranslateY += 50;
            updateCameraView();
        });
        
        moveDownBtn.addEventListener('click', () => {
            cameraTranslateY -= 50;
            updateCameraView();
        });
        
        // 摄像机控制 - 鼠标拖拽
        sceneContainer.addEventListener('mousedown', (e) => {
            if (e.button === 0) { // 左键
                isLeftMouseDown = true;
            } else if (e.button === 2) { // 右键
                isRightMouseDown = true;
                e.preventDefault(); // 阻止右键菜单
            }
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
        });
        
        document.addEventListener('mousemove', (e) => {
            if (isLeftMouseDown) {
                // 旋转视角
                const deltaX = e.clientX - lastMouseX;
                const deltaY = e.clientY - lastMouseY;
                
                cameraRotationY += deltaX * 0.5;
                cameraRotationX += deltaY * 0.5;
                
                // 限制垂直旋转角度
                if (cameraRotationX > 90) cameraRotationX = 90;
                if (cameraRotationX < -90) cameraRotationX = -90;
                
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                
                updateCameraView();
            } else if (isRightMouseDown) {
                // 平移视角
                const deltaX = e.clientX - lastMouseX;
                const deltaY = e.clientY - lastMouseY;
                
                cameraTranslateX += deltaX;
                cameraTranslateY += deltaY;
                
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                
                updateCameraView();
            }
        });
        
        document.addEventListener('mouseup', (e) => {
            if (e.button === 0) {
                isLeftMouseDown = false;
            } else if (e.button === 2) {
                isRightMouseDown = false;
            }
        });
        
        // 阻止右键菜单
        sceneContainer.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });
        
        // 鼠标滚轮缩放
        sceneContainer.addEventListener('wheel', (e) => {
            e.preventDefault();
            if (e.deltaY < 0) {
                // 放大
                cameraZoom += 0.1;
                if (cameraZoom > 2) cameraZoom = 2;
            } else {
                // 缩小
                cameraZoom -= 0.1;
                if (cameraZoom < 0.5) cameraZoom = 0.5;
            }
            updateCameraView();
        });
        
        // 光源旋转控制
        rotateCW.addEventListener('click', () => {
            lightRotation += 45;
            imageRotation -= 45; // 像逆向旋转
            
            // 应用旋转
            if (currentLightSource === 'candle') {
                // 计算像大小比例
                const objectDistance = Math.abs(parseFloat(objectPanel.style.left) || -350);
                const imageDistance = Math.abs(parseFloat(imagePanel.style.left) || 350);
                const sizeRatio = imageDistance / objectDistance;
                
                const baseSizePercent = parseInt(lightSizeSlider.value) / 100;
                const imageScale = baseSizePercent * sizeRatio;
                
                candle.style.transform = `translate(-50%, -50%) rotate(${lightRotation}deg) scale(${baseSizePercent})`;
                imageFlame.style.transform = `translate(-50%, -50%) rotate(${imageRotation}deg) scaleX(-1) scale(${imageScale})`;
            } else {
                // 计算像大小比例
                const objectDistance = Math.abs(parseFloat(objectPanel.style.left) || -350);
                const imageDistance = Math.abs(parseFloat(imagePanel.style.left) || 350);
                const sizeRatio = imageDistance / objectDistance;
                
                const baseSizePercent = parseInt(lightSizeSlider.value) / 100;
                const imageScale = baseSizePercent * sizeRatio;
                
                fShape.style.transform = `translate(-50%, -50%) rotate(${lightRotation}deg) scale(${baseSizePercent})`;
                fImageShape.style.transform = `translate(-50%, -50%) rotate(${imageRotation}deg) scaleX(-1) scale(${imageScale})`;
            }
            
            phenomenonIndicator.textContent = "现象提示：当物体顺时针旋转时，像会逆时针旋转，体现倒立成像的特性。";
        });
        
        rotateCCW.addEventListener('click', () => {
            lightRotation -= 45;
            imageRotation += 45; // 像逆向旋转
            
            // 应用旋转
            if (currentLightSource === 'candle') {
                // 计算像大小比例
                const objectDistance = Math.abs(parseFloat(objectPanel.style.left) || -350);
                const imageDistance = Math.abs(parseFloat(imagePanel.style.left) || 350);
                const sizeRatio = imageDistance / objectDistance;
                
                const baseSizePercent = parseInt(lightSizeSlider.value) / 100;
                const imageScale = baseSizePercent * sizeRatio;
                
                candle.style.transform = `translate(-50%, -50%) rotate(${lightRotation}deg) scale(${baseSizePercent})`;
                imageFlame.style.transform = `translate(-50%, -50%) rotate(${imageRotation}deg) scaleX(-1) scale(${imageScale})`;
            } else {
                // 计算像大小比例
                const objectDistance = Math.abs(parseFloat(objectPanel.style.left) || -350);
                const imageDistance = Math.abs(parseFloat(imagePanel.style.left) || 350);
                const sizeRatio = imageDistance / objectDistance;
                
                const baseSizePercent = parseInt(lightSizeSlider.value) / 100;
                const imageScale = baseSizePercent * sizeRatio;
                
                fShape.style.transform = `translate(-50%, -50%) rotate(${lightRotation}deg) scale(${baseSizePercent})`;
                fImageShape.style.transform = `translate(-50%, -50%) rotate(${imageRotation}deg) scaleX(-1) scale(${imageScale})`;
            }
            
            phenomenonIndicator.textContent = "现象提示：当物体逆时针旋转时，像会顺时针旋转，体现倒立成像的特性。";
        });
        
        // 小孔形状选择
        shapeOptions.forEach(option => {
            option.addEventListener('click', () => {
                // 移除所有active类
                shapeOptions.forEach(opt => opt.classList.remove('active'));
                // 添加active到当前选项
                option.classList.add('active');
                
                const shape = option.getAttribute('data-shape');
                switch(shape) {
                    case 'circle':
                        pinhole.style.borderRadius = '50%';
                        pinhole.style.clipPath = '';
                        break;
                    case 'square':
                        pinhole.style.borderRadius = '0';
                        pinhole.style.clipPath = '';
                        break;
                    case 'triangle':
                        pinhole.style.borderRadius = '0';
                        pinhole.style.clipPath = 'polygon(50% 0%, 0% 100%, 100% 100%)';
                        break;
                    case 'star':
                        pinhole.style.borderRadius = '0';
                        pinhole.style.clipPath = 'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)';
                        break;
                }
                
                phenomenonIndicator.textContent = "现象提示：小孔形状改变，像不会受到影响，只由光线的传播路径决定。";
            });
        });
        
        // 窗口大小调整时更新
        window.addEventListener('resize', () => {
            setTimeout(updateCameraView, 100);
        });
    </script>
</body>
</html>
